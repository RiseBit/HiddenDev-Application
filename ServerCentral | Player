---\ Services
local RS = game:GetService("ReplicatedStorage")

---/\ RemoteEvents
local REFolder = RS:WaitForChild("GuiRE")
local AddRE = REFolder.Add
local SubtractRE = REFolder.Subtract
local ExitRE = REFolder.Exit
local BuyRE = REFolder.Buy

---\ Modules
local Modules = require(script.ShopModule)
local Ingredient = require(script.ShopModule.Ingredient)

---\ Tables
local basketCounts = {}

---/\ Value
local IngFolder = RS.Ingredient

for _, v in ipairs(IngFolder:GetChildren()) do
	if not v:IsA("IntValue") then continue end

	local valueName = v.Name
	for ingredientName, properties in pairs(Ingredient) do
		if properties[valueName] then
			v.Value = properties[valueName]
			break 
		end
	end
end

AddRE.OnServerEvent:Connect(function(plr, itemName) 
	if not itemName then return end

	basketCounts[itemName] = basketCounts[itemName] or 0

	if Modules:Add(itemName) then
		basketCounts[itemName] += 1
	end
end)

SubtractRE.OnServerEvent:Connect(function(plr, itemName)
	if not itemName then return end

	basketCounts[itemName] = basketCounts[itemName] or 0
	if basketCounts[itemName] <= 0 then return end


	if Modules:Subtract(itemName) then
		basketCounts[itemName] -= 1
	end
end)

ExitRE.OnServerEvent:Connect(function(plr)
	Modules:Exit(basketCounts)
end)

BuyRE.OnServerEvent:Connect(function(plr, basket)
	if not basket then return end

	local status = Modules:Buy(plr, basket)
	BuyRE:FireClient(plr, status)
end)
